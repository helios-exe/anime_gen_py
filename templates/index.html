<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Real or Fake Anime</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>
  <div class="container">

    <h1 id="mainText">real or fake?</h1>

    <div id="options" class="options-container">
      <!-- Buttons injected here -->
    </div>

    <p id="feedback" class="feedback"></p>

    <p class="score">
      Score: <span id="scoreValue">0</span>
    </p>

    <button id="nextBtn" onclick="nextRound()">Next</button>

  </div>

  <script>
    let realTitles = [];
    let correctAnswer = "";
    let score = parseInt(localStorage.getItem("score") || "0");

    document.getElementById("scoreValue").innerText = score;

    // Load 25k titles.json ONCE
    async function loadTitles() {
      const res = await fetch("/static/titles.json");
      realTitles = await res.json();
      nextRound(); // start first round after load
    }

    // Pick random real title
    function pickRealTitle() {
      const item = realTitles[Math.floor(Math.random() * realTitles.length)];
      return item.title_english || item.title; // fallback
    }

    // Fetch fake title from Flask
    async function fetchFakeTitle() {
      const res = await fetch("/generate");
      const data = await res.json();
      return data.title;
    }

    // Build round
    async function nextRound() {
      document.getElementById("feedback").innerText = "";
      const real = pickRealTitle();
      const fake = await fetchFakeTitle();

      correctAnswer = real;

      let options = [real, fake].sort(() => Math.random() - 0.5);

      const container = document.getElementById("options");
      container.innerHTML = "";

      options.forEach(option => {
        const btn = document.createElement("button");
        btn.className = "option-btn";
        btn.innerText = option;
        btn.onclick = () => checkAnswer(option);
        container.appendChild(btn);
      });
    }

    // Handle guessing
    function checkAnswer(selected) {
      if (selected === correctAnswer) {
        document.getElementById("feedback").innerText = "✅ Correct!";
        score++;
      } else {
        document.getElementById("feedback").innerText =
          "❌ Wrong — this is fake!";
        score = Math.max(0, score - 1);
      }
      localStorage.setItem("score", score);
      document.getElementById("scoreValue").innerText = score;
    }

    // Load data when page opens
    window.onload = loadTitles;
  </script>

</body>
</html>
